"""
imot.bg CSS selectors and regex patterns.

Centralizes all site-specific patterns for easier maintenance.
When imot.bg changes their HTML structure, update patterns here.
"""

# =============================================================================
# URL PATTERNS
# =============================================================================

# Extract listing ID from URL: obiava-{id}-prodava-...
LISTING_ID_PATTERN = r"obiava-([a-zA-Z0-9]+)-"

# Extract neighborhood from URL: grad-sofiya-{neighborhood}
NEIGHBORHOOD_URL_PATTERN = r"grad-sofiya-([a-z0-9-]+?)(?:-ul-|-prodava-|$)"

# Pagination pattern in URL
PAGE_URL_PATTERN = r"/p-(\d+)"

# =============================================================================
# LISTING LINK PATTERNS (for search results)
# =============================================================================

# Links that are property listings contain these substrings
LISTING_LINK_CONTAINS = ["/obiava-", "-prodava-"]

# =============================================================================
# PAGINATION SELECTORS (for is_last_page detection)
# =============================================================================

# Pagination container
PAGINATION_CONTAINER = "div.pagination, .pages, nav[aria-label='pagination']"

# Next page link patterns
NEXT_PAGE_SELECTORS = [
    "a.next",
    "a[rel='next']",
    "a:contains('следваща')",
    "a:contains('>')",
    ".pagination a.next",
]

# Current page indicator
CURRENT_PAGE_SELECTOR = ".pagination .current, .pages .current, span.current"

# "No results" indicators
NO_RESULTS_PATTERNS = [
    "няма намерени обяви",
    "няма резултати",
    "no results",
    "0 обяви",
]

# =============================================================================
# PRICE PATTERNS
# =============================================================================

PRICE_PATTERNS = [
    r"([\d\s]+)\s*€",           # 242 400 €
    r"([\d\s]+)\s*EUR",         # 242 400 EUR
    r"€\s*([\d\s]+)",           # € 242 400
    r"([\d\s]+)\s*евро",        # 242 400 евро
]

# =============================================================================
# SIZE PATTERNS (square meters)
# =============================================================================

SQM_PATTERNS = [
    r"([\d.,]+)\s*(?:кв\.?\s*м\.?|m2|m²|sqm)",  # 71 кв.м, 71 m², 71 sqm
    r"площ[:\s]*([\d.,]+)",                      # площ: 71
    r"([\d.,]+)\s*(?:sq\.?\s*m)",                # 71 sq.m
]

# =============================================================================
# FLOOR PATTERNS
# =============================================================================

FLOOR_PATTERNS = [
    # "Етаж: 3/6" or "Етаж 3/6" (colon optional, slash separator)
    r"[Ее]таж:?\s*(\d+)\s*/\s*(\d+)",
    # "Етаж 3 от 6" or "Етаж: 3 от 6"
    r"[Ее]таж:?\s*(\d+)\s*от\s*(\d+)",
    # "3-ти ет. от 6", "3-ри етаж от 6"
    r"(\d+)[-\s]*(?:ми|ри|ти|ви)?\s*(?:ет\.?|етаж)\s*(?:от|/)\s*(\d+)",
    # "3/6 етаж"
    r"(\d+)\s*/\s*(\d+)\s*(?:ет|етаж)",
]

# Floor number only (no total)
FLOOR_NUMBER_ONLY_PATTERN = r"[Ее]таж:?\s*(\d+)(?:\s|$)"

# =============================================================================
# ROOM COUNT MAPPINGS
# =============================================================================

# Bulgarian room type words to count
ROOM_WORDS_BG = {
    "едностаен": 1,
    "двустаен": 2,
    "тристаен": 3,
    "четиристаен": 4,
    "многостаен": 5,
    "мезонет": 3,
}

# URL slug mappings (Latin transliteration)
ROOM_SLUGS = {
    "ednostaen": 1,
    "dvustaen": 2,
    "tristaen": 3,
    "chetiristaen": 4,
    "mnogostaen": 5,
    "mezonet": 3,
}

# Numeric pattern: "3-стаен"
ROOM_NUMERIC_PATTERN = r"(\d+)\s*[-]?\s*ста"

# =============================================================================
# BATHROOM PATTERNS
# =============================================================================

BATHROOM_PATTERNS = [
    r"(\d+)\s*(?:бани|баня|санитарн|wc|тоалетн)",  # 2 бани, 2 санитарни
    r"(?:бани|баня|санитарн)[:\s]*(\d+)",          # баня: 2
]

# Keywords indicating 2+ bathrooms
TWO_BATHROOM_KEYWORDS = [
    "2 бани",
    "две бани",
    "2 санитарни",
    "две санитарни",
    "2 тоалетни",
    "две тоалетни",
]

# =============================================================================
# BUILDING TYPE KEYWORDS
# =============================================================================

BUILDING_TYPES = {
    "panel": ["панел", "епк", "едропанел", "пк"],
    "brick": ["тухла", "керамични тухли", "гредоред", "brick"],
    "new_construction": [
        "ново строителство",
        "new construction",
        "ново стр.",
    ],
}

# =============================================================================
# ACT STATUS PATTERNS
# =============================================================================

ACT_STATUS_PATTERNS = {
    "act16": [
        r"акт\s*16",
        r"act\s*16",
        r"разрешение за ползване",
    ],
    "act15": [
        r"акт\s*15",
        r"act\s*15",
        r"удостоверение за въвеждане",
    ],
    "act14": [
        r"акт\s*14",
        r"act\s*14",
        r"груб строеж",
    ],
}

# =============================================================================
# METRO / LOCATION PATTERNS
# =============================================================================

# Metro station names in Sofia
SOFIA_METRO_STATIONS = [
    "сердика", "св. климент охридски", "опълченска", "западен парк",
    "вардар", "константин величков", "обеля", "люлин", "запад",
    "бизнес парк", "младост", "интер експо център", "цариградско шосе",
    "академик александър теодоров-балан", "г.м. димитров", "мусагеница",
    "жолио кюри", "надежда", "хан кубрат", "княгиня мария луиза",
    "централна гара", "лъвов мост", "орлов мост", "стадион васил левски",
    "джеймс баучер", "витоша", "хладилника", "околовръстен път",
]

# Metro distance patterns
METRO_DISTANCE_PATTERNS = [
    r"(\d+)\s*(?:м|m|метра|meters?)\s*(?:до|от|from)?\s*метро",
    r"метро[:\s]*(\d+)\s*(?:м|m|метра)",
    r"(\d+)\s*(?:м|m)\s*(?:до|от)\s*(?:метро|metro)",
]

# =============================================================================
# FEATURE KEYWORDS
# =============================================================================

FEATURES = {
    "elevator": ["асансьор", "elevator", "lift"],
    "balcony": ["балкон", "тераса", "balcony", "terrace"],
    "parking": ["паркомясто", "гараж", "parking", "garage", "паркинг"],
    "storage": ["мазе", "таван", "storage", "basement", "склад"],
    "garden": ["двор", "градина", "garden", "yard"],
    "furnished": ["обзаведен", "furnished", "мебелиран"],
    "ac": ["климатик", "air condition", "a/c", "ac"],
}

# =============================================================================
# ORIENTATION KEYWORDS
# =============================================================================

ORIENTATION_MAPPING = {
    "изток": "E",
    "запад": "W",
    "север": "N",
    "юг": "S",
    "югоизток": "SE",
    "югозапад": "SW",
    "североизток": "NE",
    "северозапад": "NW",
}

# =============================================================================
# HEATING KEYWORDS
# =============================================================================

HEATING_TYPES = {
    "central": ["топлофикация", "тец", "парно", "централно"],
    "gas": ["газ", "газово", "газов котел"],
    "electric": ["електричество", "ток", "електрическо"],
    "ac": ["климатик", "климатици"],
    "fireplace": ["камина"],
}

# =============================================================================
# CONDITION KEYWORDS
# =============================================================================

CONDITION_TYPES = {
    "ready": ["завършен", "ready", "до ключ", "обзаведен"],
    "renovation": ["ремонт", "renovation", "за ремонт"],
    "bare_walls": ["на шпакловка", "довършителни", "акт 15", "груб строеж"],
}

# =============================================================================
# IMAGE PATTERNS
# =============================================================================

# imot.bg image hosting domain pattern
IMAGE_HOST_PATTERN = r"imotstatic.*?\.focus\.bg"

# Valid image extensions
IMAGE_EXTENSIONS = [".jpg", ".jpeg", ".png", ".webp"]

# =============================================================================
# CONTACT PATTERNS
# =============================================================================

# Bulgarian phone number pattern
PHONE_PATTERN = r"(\+?359|0)\s*\d{2,3}\s*\d{3}\s*\d{2,3}"

# Agency subdomain pattern: {agency}.imot.bg
AGENCY_SUBDOMAIN_PATTERN = r"//([^.]+)\.imot\.bg"

# =============================================================================
# DESCRIPTION KEYWORDS (to identify description blocks)
# =============================================================================

DESCRIPTION_KEYWORDS = [
    "апартамент",
    "стая",
    "кухня",
    "баня",
    "етаж",
    "площ",
    "имот",
    "жилище",
]
